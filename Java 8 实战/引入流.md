##引入流
**流**（stream）是从支持数据处理操作的源生成的**元素序列**。
- **元素序列**
> 流提供了一个可以访问特定元素类型的一组有序值的接口。
> 
> 流的目的在于表达计算。
- **源**
> 流会使用一个提供数据的源。
- **数据处理操作**
> 支持类似于数据库的操作，以及函数式编程语言中的常用操作。
> 
> 可以顺序执行，也可并行执行。
- **流水线**
> 很多流操作本身会返回一个流，这样多个操作就可以链接起来，形成流水线。
> 
> 可以看作是对数据源进行数据库式查询。
- **内部迭代**
> 流的迭代操作隐式执行。

![](http://i.imgur.com/LpFV2rR.png)
- **filter**
> 接受一个 Lambda，从流中排除某些元素。
- **map**
> 接受一个 Lambda，将元素转换成其他形式或提取信息。
- **limit**
> 截断流，使其元素不超过给定数量。
- **collect**
> 将流转换为其他形式。

流允许你以**声明性方式**处理数据集合，可把流看作遍历数据集的**高级迭代器**。
> 流还可**透明地并行处理**。

Stream API 可以让你写出这样的代码：
- **声明性**
> 代码是以声明性方式写的：说明想要完成什么，而不是说明如何实现一个操作。
- **可复合**
> 可将几个基础操作链接起来，来表达复杂的数据处理流水线。
- **可并行**
> 由于 filter、 sorted、 map 和 collect 等操作是**与具体线程模型无关的高层次构件**，所以它们的内部实现既可以是**单线程的**，也可能透明地**充分利用多核架构**。
> 
> 若要利用多核架构并行执行代码，只需要把 stream() 替换成 **parallelStream()**。

###流与集合
集合与流之间的差异在于**何时进行计算**。
- 集合是一个**内存中的数据结构**，它包含数据结构中目前**所有的值**。
> 集合中的每个元素都得**先计算出来才能添加**到集合中。
- 流则是在**概念上固定的数据结构**（不能添加或删除元素），其元素则是**按需计算**的。
> 流就像是一个**延迟创建的集合**：只有在消费者要求的时候才会计算值。

流**只能遍历一次**，遍历完成后，这个流就已经被消费掉了。
> 可以从原始数据源那里再获得一个新的流来重新遍历一遍，就像迭代器一样。
> > 假设数据源是集合之类的可重复的源，而非 I/O 通道。

![](http://i.imgur.com/lI1Dgo0.png)
- 使用 Collection 接口需要用户执行**显式迭代**（比如使用 for-each），这称为**外部迭代**。
> 若通过 for-each 选择了外部迭代，则需要自己管理所有的并行问题。
- Streams 库则使用**内部迭代**，它在内部替代用户完成迭代操作，并将得到的流值存在某个地方。
> Streams 库的内部迭代可以自动选择一种适合你硬件的数据表示和并行实现。

###流操作
Stream 接口定义了许多操作，它们可以分为两大类：
- **中间操作**
> 中间操作会返回另一个流，这让多个操作可以连接起来形成一个查询。
> 
> 除非流水线上触发一个终端操作，否则中间操作不会执行任何处理。
- **终端操作**
> 终端操作会从流的流水线生成结果，其结果为任何不是流的值。

流的使用一般包括三件事：
- 一个**数据源**（如集合）来执行一个查询
- 一个**中间操作链**，形成一条流的流水线
> 流水线背后的理念类似于 Builder Pattern。
> > 在 Builder Pattern 中有一个调用链用来设置一套配置（对流来说这就是一个中间操作链），接着是调用 built 方法（对流来说就是终端操作）。
- 一个**终端操作**，执行流水线，并能生成结果

**中间操作**

| 操作 | 类型 | 返回类型 | 操作参数 | 函数描述符 | 目的 |
| --- | --- | --- | --- | --- | --- |
| filter | 中间 | Stream<T> | Predicate<T> | T -> boolean | - |
| map | 中间 | Stream<R> | Function<T, R> | T -> R | - |
| limit | 中间 | Stream<T> | - | - | - |
| sorted | 中间 | Stream<T> | Comparator<T> | (T, T) -> int | - |
| distinct | 中间 | Stream<T> | - | - | - |

**终端操作**

| 操作 | 类型 | 目的 |
| --- | --- | --- |
| forEach | 终端 | 消费流中的每个元素并对其应用 Lambda。这一操作返回 void |
| count | 终端 | 返回流中元素的个数。这一操作返回 long |
| collect | 终端 | 把流归约成一个集合，比如 List、 Map 甚至是 Integer |
